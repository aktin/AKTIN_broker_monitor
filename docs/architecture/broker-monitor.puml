@startuml
hide methods

title __Diagram of Broker-Monitor__\n

package "node_to_csv.py" <<Package>> {
class PropertiesJsonReader {
* validates settings file
* loads settings as python environment variables
}

abstract class CSVHandler {
* operations for reading and writing csv files
* contains configuration variables for reading csv files
* gets the encoding of a csv file
}

abstract BrokerNodeConnection {
* uses REST endpoint of broker-server to get
information about connected broker nodes
}

abstract class BrokerNodeFetcher {
* gets information of broker nodes and saves them in a csv file
* each node has a corresponding csv file
* csv files are rotated each month
* all csv files of a node are collected in a corresponding folder
}

class NodeErrorFetcher {
* fetches broker node errors
* each column in csv file stands for one error
}

class NodeInfoFetcher {
* fetches broker node contact and startup
* fetches broker node import stats
* computes daily imports from differences to previous day
* computes daily error rate
* each column in csv file stands for one day
}

BrokerNodeFetcher --> CSVHandler
BrokerNodeFetcher --> BrokerNodeConnection
NodeErrorFetcher --|> BrokerNodeFetcher
NodeInfoFetcher --|> BrokerNodeFetcher
}

entity "AKTIN Broker" as broker
entity broker #aliceblue;line:blue;text:blue
hide broker members
hide broker circle

entity "CSV" as csv
entity csv #aliceblue;line:blue;text:blue
hide csv members
hide csv circle

entity "JSON file with configuration" as settings {
* URL broker-server
* API Key broker-server
* Working directory
}
entity settings #aliceblue;line:blue;text:blue
hide settings circle

BrokerNodeConnection -d-> broker
CSVHandler -d-> csv
PropertiesJsonReader --> settings
BrokerNodeConnection .l.> settings
BrokerNodeFetcher .l.> settings

@enduml
